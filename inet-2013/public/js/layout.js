// Generated by CoffeeScript 1.6.3
(function() {
  var get_cheked_button;

  window.vote = function(voting) {
    var checked, r;
    r = new XMLHttpRequest();
    r.onreadystatechange = function() {
      var img, new_img;
      if (r.readyState !== 4 || r.status !== 200) {
        return;
      }
      img = document.querySelector('#vote_result');
      if (r.responseText.indexOf('src') !== -1 && img) {
        new_img = r.responseText.match(/src='(.*)'/)[1];
        if (img.getAttribute('src') !== new_img) {
          return img.setAttribute('src', new_img);
        }
      } else {
        return document.getElementById('voting').innerHTML = r.responseText;
      }
    };
    if (voting) {
      checked = get_cheked_button();
    }
    if (checked) {
      r.open('POST', "/voting", true);
      r.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      return r.send("vote=" + checked);
    } else {
      r.open('GET', "/voting", true);
      return r.send(null);
    }
  };

  setInterval(function() {
    return vote(false);
  }, 10000);

  get_cheked_button = function() {
    if (document.getElementById('ok').checked) {
      return 'ok';
    }
    if (document.getElementById('sr_ok').checked) {
      return 'sr_ok';
    }
    if (document.getElementById('ne_ok').checked) {
      return 'ne_ok';
    }
    return false;
  };

}).call(this);
