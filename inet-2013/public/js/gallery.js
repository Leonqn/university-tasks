// Generated by CoffeeScript 1.6.3
(function() {
  var close_image, get_cookie, get_img, get_next_image, get_prev_image, preload, set_cookie, set_img, show_next_image, show_prev_image;

  window.show = function(e) {
    var img, target;
    e = e || window.event;
    target = (e.srcElement || e.target).parentNode;
    if (target.nodeName === 'A') {
      img = get_img();
      set_img(img, target.getAttribute('title'));
      return img.parentNode.setAttribute('style', "display: flex; display: -ms-flexbox;");
    }
  };

  get_img = function() {
    return document.getElementById('overlay').getElementsByTagName('img')[0];
  };

  set_img = function(img, id) {
    window.imgs = window.imgs || document.getElementById('thumbs').getElementsByTagName('a');
    window.history.pushState({
      id: id
    }, null, "/gallery/" + (window.imgs[id].getAttribute('title')));
    img.setAttribute('id', id);
    img.src = window.imgs[id].getAttribute('href');
    if (!img.complete) {
      document.getElementById("loading").style.display = 'inline';
    }
    img.alt = window.imgs[id].getAttribute('title');
    return preload();
  };

  preload = function() {
    var next_id, prev_id, _, _ref, _ref1;
    _ref = get_prev_image(), _ = _ref[0], prev_id = _ref[1];
    _ref1 = get_next_image(), _ = _ref1[0], next_id = _ref1[1];
    document.createElement('img').src = window.imgs[prev_id].getAttribute('href');
    return document.createElement('img').src = window.imgs[next_id].getAttribute('href');
  };

  get_prev_image = function() {
    var id, img;
    img = get_img();
    id = parseInt(img.getAttribute('id'));
    id = id <= 0 ? window.imgs.length - 1 : id - 1;
    return [img, id];
  };

  show_prev_image = function() {
    var id, img, _ref;
    _ref = get_prev_image(), img = _ref[0], id = _ref[1];
    return set_img(img, id);
  };

  get_next_image = function() {
    var id, img;
    img = get_img();
    id = parseInt(img.getAttribute('id'));
    id = id >= window.imgs.length - 1 ? 0 : id + 1;
    return [img, id];
  };

  show_next_image = function() {
    var id, img, _ref;
    _ref = get_next_image(), img = _ref[0], id = _ref[1];
    return set_img(img, id);
  };

  close_image = function() {
    var img;
    img = get_img();
    img.parentNode.style.display = 'none';
    img.src = '';
    return window.history.pushState({
      id: null
    }, null, "/gallery");
  };

  window.next = function(e) {
    var id, target;
    window.imgs = window.imgs || document.getElementById('thumbs').getElementsByTagName('a');
    e = e || window.event;
    target = e.target || e.srcElement;
    id = target.getAttribute('id');
    if (id === 'prev' || id === 'prev_img') {
      return show_prev_image();
    }
    if (id === 'close' || id === 'close_img') {
      return close_image();
    }
    if (id === 'do_start') {
      return do_start();
    }
    return show_next_image();
  };

  document.onkeyup = function(e) {
    var overlay;
    overlay = document.getElementById('overlay');
    if (overlay.style.display !== 'none') {
      switch (e.keyCode) {
        case 37:
          return show_prev_image();
        case 39:
          return show_next_image();
        case 27:
          return close_image();
      }
    }
  };

  window.onpopstate = function(e) {
    var id, img;
    if (e.state !== null) {
      img = get_img();
      if (e.state.id === null) {
        img.parentNode.style.display = 'none';
        img.src = '';
        return;
      }
      if (img.parentNode.style.display === 'none') {
        img.parentNode.setAttribute('style', "display: flex; display: -ms-flexbox;");
      }
      id = e.state.id;
      window.imgs = window.imgs || document.getElementById('thumbs').getElementsByTagName('a');
      img.setAttribute('id', id);
      img.src = window.imgs[id].getAttribute('href');
      return img.alt = window.imgs[id].getAttribute('title');
    }
  };

  window.opacity_buttons_over = function(ctx) {
    return ctx.firstElementChild.style.opacity = 1;
  };

  window.opacity_buttons_out = function(ctx) {
    return ctx.firstElementChild.style.opacity = 0.4;
  };

  set_cookie = function(img) {
    return document.cookie = "id=" + (img.getAttribute('id'));
  };

  window.onload = function() {
    var cook, img;
    img = get_img();
    cook = get_cookie('id');
    if (cook !== void 0 && img.getAttribute('id') === 'img') {
      img.parentNode.setAttribute('style', "display: flex; display: -ms-flexbox;");
      set_img(img, cook);
      return preload();
    }
  };

  get_cookie = function(name) {
    var matches;
    matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"));
    if (matches) {
      return decodeURIComponent(matches[1]);
    } else {
      return void 0;
    }
  };

  window.do_start = function() {
    return set_cookie(get_img());
  };

}).call(this);
